# Contributor: Carlo Landmeter <clandmeter@alpinelinux.org>
# Maintainer:
pkgname=minio
_pkgver="RELEASE.2019-03-06T22-47-10Z"
pkgver=${_pkgver#*.}
pkgver=${pkgver%T*}
pkgver=0.${pkgver//-}
pkgrel=0
pkgdesc="An open source object storage server compatible with Amazon S3"
url="https://minio.io/"
arch="all"
license="Apache-2.0"
makedepends="go"
source="https://github.com/minio/minio/archive/$_pkgver.tar.gz"
builddir="$srcdir/src/github.com/minio/$pkgname"

prepare() {
    mkdir -p ${builddir%/*}
    mv "$srcdir"/$pkgname-$_pkgver "$builddir"/
    cd "$builddir"
    default_prepare
}

build() {
    cd "$builddir"
    export GOPATH="$srcdir"
	export CGO_ENABLED=0
	local _ldflags=$(go run buildscripts/gen-ldflags.go 2> /dev/null)
	go build -tags kqueue --ldflags "$_ldflags" -o bin/minio
}

package() {
	install -Dm755 "$builddir"/bin/minio \
		"$pkgdir"/usr/bin/minio
}

sha512sums="09c1ec200320f0843fd41711a2fe1596af906c84d82dfa080a15fa8e98713601adbc21b91d4c82d436f128cc00fe75575f88ddefc25e1ce5ed72bd2d65dfce12  RELEASE.2019-03-06T22-47-10Z.tar.gz"
